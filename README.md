# Foundational Industry Energy Data

## Summary

This is an effort by the National Renewable Energy Laboratory (NREL) and Argonne National Laboratory (ANL) to create a foundational industry dataset for energy and emissions analysis and modeling. The code draws from various publicly-available data, primarily from the U.S. EPA, to compile a data set on unit-level energy use and characterization for U.S. industrial facilities in 2017.

## Getting Started

The dataset is generated by first running `frs_extraction.py` and then `fied_compilation.py`. `frs_extraction.py` is responsible for downloading and formatting EPA Facility Registry Service (FRS) data. `fied_compilation.py` functions by calling the remaining submodules responsible for data gathering, munging, and calculations, as well as its own methods for combining this intermediate data into the final dataset. These files can be run from the root directory in terminal with 

```
python ./frs/frs_extraction.py
python fied_compilation.py
```

`fied_environment.yml` is the conda environment used when creating the foundational dataset. Its key dependencies include:

* `python=3.6.5=h0c2934d_0`
* `pandas=0.24.2=py36he350917_0`
* `numpy=1.19.1=py36h12ee977_2`

## Compiling the Dataset

### Manual Data Downloads

Due to their nature, several data sets must be manually downloaded before the code can be run sucessfully. These data sets and their director locations are:

1. Source Classification Codes (SCCs)
  * Download from https://sor-scc-api.epa.gov/sccwebservices/sccsearch/
  * Save to `data/SCC/SCCDownload.csv`
2. 2017 National Emissions Inventory (NEI)
  * Download from https://gaftp.epa.gov/air/nei/2017/data_summaries/2017v1/2017neiJan_facility_process_byregions.zip
  * Save **and unzip** data to `data/NEI/`.
  * `nei_EF_calculations.py` will format and combine the unzipped csv files into `nei_ind_data.csv`
3. GHGRP Emissions by Unit and Fuel Type
  * Download from https://www.epa.gov/system/files/other-files/2022-10/emissions_by_unit_and_fuel_type_c_d_aa_10_2022.zip'
  * Save to `data/GHGRP/`
  * `ghgrp_fac_unit.py` will unzip and format these data.

### Running Code

In addition to manually downloading the above datasets, executing the calulations and data compilation requires two steps.

1. Run `frs_extraction.py`. This will download, extract, and format EPA FRS data. The resulting csv should be saved in `data/FRS/`.
2. Run `fied_compilation.py`. This will execute all of the remaining steps for compiling the foundational data set. The resulting file will be saved in the root directory.

## Directory Navigation

The underlying submodules and data are organized as follows:

* [analysis](/analysis/): Methods for analyzing and generating figures of the final dataset.
* [data](/data/): Most folders are created locally for organizing raw data. Contains a [directory list](/data/dir_structure.md).
* [energy](/energy/): Not currently used. For future estimation of facility energy use based on alternative approaches. 
* [frs](/frs): Methods for downloading and formatting EPA Facility Registry Service data.
* [geocoder](/geocoder/): Methods for collecting missing geographical information for facilities.
* [ghgrp](/ghgrp/): Methods for estimating energy use from GHG emissions reported under EPA's Greenhouse Gas Reporting Program. Based on previous projects, such as the [Industry Energy Data Book](https://github.com/NREL/Industry-energy-data-book).
* [nei](/nei/): Methods for downloading and formatting data from EPA's National Emissions Inventory and for using these data to characterize combustion units.
* [qpc](/qpc/): Methods for downloading and formatting operating hours reported under the Census Bureau's Quaterly Survey of Plant Capacity Utlization.
* [scc](/scc/):  Methods to download and apply EPA's Source Classification Codes for characterizing units.
* [tests](/tests/): Testing. Currently very limited.
* [tools](/tools/): Methods that act as various tools used across submodules.

## Overivew of Foundational Industry Energy Data Fields

All facilities in the data set are represented by their unique `registryID`, which is their EPA [Facility Registry Service ID](https://www.epa.gov/frs/frs-physical-data-model).

Many of these data fields were included in original EPA data sources. See the [FRS data dictionary](https://www.epa.gov/frs/frs-data-dictionary) for more information.

### Identity

In addition to `registryID`, other identifying fields include

* `eisFacilityID`: EPA ID assigned to facilities reporting to the Emissions Inventory System (EIS)
* `ghgrpID`: EPA ID assigned to facilities reporting under the Greenhouse Gas Reporting Program (GHGRP)
* `name`: Name of facility.
* `locationDescription`: Description of the facility location.
* `naicsCode`: The facility's North American Industrial Classification System (NAICS) code.
* `naicsCodeAdditional`: A facility may have additional NAICS codes assigned (e.g., different reporting systems may have different NAICS assigned).

### Geography

Various levels of geographic identifiers are included, such as

* `censusBlock`
* `latitude`
* `longitude`
* `postalCode`
* `countyNAME`
* `countyFIPS`
* `stateName`
* `legislativeDisctrictNumber`

### Units and Processes

Individual units are characterized (e.g., unit type, capacity, energy, throughput) where possible. Individual units may be associated with multiple processes.

* `designCapacity`
* `eisUnitID`
* `unitName`
* `unitType`
* `unitTypeStd`
* `processDescription`
* `eisProcessID`

### Energy

Depending on the estimation approach, a unit may have a single estimate of energy use, or a range of energy estimates (i.e., minimum, median, upper quartile).

* `energyMJ`: energy estimate in MJ
* `energyMJ0`: minimum of energy estimate, in MJ
* `energyMJq2`: median of energy estimate, in MJ
* `energyMJq3`: upper quartile of energy estimate, in MJ.
* `fuelType`

### Other

We've attempted to include additional descriptive fields where possible. These tend to be sparsely populated at this time.

* `hucCode8`: Hydrolic Unit Code
* `weeklyOpHours`: Average weekly operating hours by quarter, including 95% confidence interval ranges.
* `sensitiveInd`: Indicates whether or not the associated data is enforcement sensitive.
* `envJusticeCode`: The code that identifies the type of environmental justice concern affecting the facility or enforcement action.
* `smallBusInd`: Code indicating whether or not a business is requesting relief under EPAâ€™s Small Business Policy, which applies to businesses having less than 100 employees.
* `througputTonne`: Estimated mass throughput
